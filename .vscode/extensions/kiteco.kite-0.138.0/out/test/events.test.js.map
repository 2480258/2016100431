{"version":3,"sources":["../external \"path\"","../external \"vscode\"","../external \"chai\"","../external \"sinon\"","../external \"kite-api\"",".././test/helpers.js",".././src/utils.js","../external \"child_process\"","../external \"os\"",".././src/urls.js","../external \"md5\"",".././test/events.test.js",".././src/events.js","../webpack/bootstrap","../webpack/runtime/compat get default export","../webpack/runtime/define property getters","../webpack/runtime/hasOwnProperty shorthand","../webpack/runtime/make namespace object","../webpack/startup"],"names":[],"mappings":";;;;;;;;AAAA,kC;;;;;;;;;;;;ACAA,oC;;;;;;ACAA,kC;;;;;;ACAA,mC;;;;;;ACAA,sC;;;;;;;;;;;;ACAa;;AAEb,aAAa,mBAAO,CAAC,CAAM;AAC3B,gBAAgB,mBAAO,CAAC,EAAU;AAClC,OAAO,wBAAwB,GAAG,mBAAO,CAAC,EAAc;;AAExD;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA,wBAAwB,gBAAgB,SAAS,IAAI;AACrD,OAAO;AACP,wBAAwB,gBAAgB,SAAS,EAAE;AACnD;AACA;AACA,KAAK;AACL,GAAG;AACH;;AAEA;AACA;AACA,qBAAqB,SAAS;AAC9B;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,GAAG;AACH;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,qBAAqB,wBAAwB;AAC7C,YAAY,OAAO,GAAG,KAAK,GAAG,cAAc;AAC5C;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC9Fa;;AAEe;AACG;AACX;;AAEW;;AAE/B;AACA,SAAS,uDAAe;AACxB;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,yBAAyB,0BAA0B;AACnD;AACA,GAAG;;AAEH;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;;AAEA;AACA;;AAEA;AACA;AACA,sBAAsB,aAAa;AACnC,sBAAsB,aAAa;AACnC;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,EAAE,8EAAuC;;AAEzC;AACA;AACA;AACA;AACA;AACA,GAAG,IAAI;AACP;;AAEA;AACA,KAAK,uDAAc;AACnB,kDAAkD;AAClD;AACA,MAAM,kDAAW;AACjB;AACA;AACA;AACA;;AAEA;AACA,8BAA8B;AAC9B;AACA,SAAS,kDAAW;AACpB;AACA,MAAM,8DAAY,iBAAiB,WAAW;AAC9C;AACA;AACA,MAAM,8DAAY,wCAAwC,WAAW;AACrE;AACA;AACA,MAAM,8DAAY,qBAAqB,WAAW;AAClD;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AA8BE;;;;;;;AC9NF,2C;;;;;;ACAA,gC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACAa;AACe;AACN;;AAES;;AAE/B;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,gBAAgB,sCAAsC;AACtD;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,WAAW,iBAAiB;AAC5B,gBAAgB,OAAO;AACvB,eAAe,MAAM;AACrB;AACA;AACA;;AAEA;AACA;AACA;AACA,gBAAgB,sCAAsC;AACtD;AACA;;AAEA;AACA;AACA;AACA,gBAAgB,sCAAsC;AACtD;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,iBAAiB,4CAAI;;AAErB;AACA;;AAEA;AACA,8BAA8B,GAAG;AACjC;;AAEA;AACA,+BAA+B,GAAG;AAClC;;AAEA;AACA;AACA,yBAAyB,GAAG;AAC5B;AACA,gBAAgB,KAAK;AACrB,eAAe,MAAM;AACrB;AACA;AACA;;AAEA;AACA;AACA,yBAAyB,GAAG;AAC5B;AACA,gBAAgB,KAAK;AACrB,eAAe,MAAM;AACrB;AACA;AACA;;AAEA;AACA,+BAA+B,GAAG;AAClC;;AAEA;AACA,iCAAiC,GAAG;AACpC;;AAEA;AACA,uEAAuE,aAAa;AACpF;AACA;;AAEA;AACA,uEAAuE,aAAa;AACpF;AACA;;AAEA;AACA,kFAAkF,aAAa;AAC/F;AACA;;AAEA;AACA,iBAAiB,wDAAe;AAChC,gBAAgB,0CAAG;AACnB;AACA;AACA;AACA;AACA;AACA,0BAA0B,OAAO,GAAG,MAAM;AAC1C;AACA,sBAAsB,IAAI;AAC1B,yBAAyB,SAAS;AAClC;AACA;AACA;;AAEA;AACA,yCAAyC;AACzC;;AAEA;AACA;AACA,mDAAmD,EAAE;AACrD;AACA;;AAEA;AACA,YAAY,gBAAgB,GAAG,mBAAmB,GAAG,cAAc,GAAG,iBAAiB;AACvF;;AAEA;AACA;AACA;;AA2BE;;;;;;;ACtLF,iC;;;;;;;;;;;;;;;;;;ACAa;;AAEe;;AAEE;AACJ;;AAEe;AACF;;AAEvC;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,eAAe,iDAAU;AACzB,kBAAkB,iDAAU;AAC5B;;AAEA,gBAAgB,sDAAe,CAAC,oDAAU;;AAE1C,WAAW,wEAAiC;AAC5C;AACA;AACA;AACA;AACA,qBAAqB,wDAAe;AACpC,mBAAmB,wDAAe;AAClC,SAAS;AACT;;AAEA,mBAAmB,gDAAY;AAC/B,KAAK;AACL,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA,MAAM,4CAAM;;AAEZ;AACA;AACA,MAAM,4CAAM;AACZ,KAAK;AACL,GAAG;AACH,CAAC;;;;;;;;;;;;;;;ACnDY;;AAEsC;;AAEd;AACrC,uBAAuB,kDAAe;;AAEtC,CAA8C;;AAE/B;AACf;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,4CAA4C,EAAE;AAC9C;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,OAAO;AACP;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAkB,2DAAoB;AACtC,sBAAsB,uCAAuC;AAC7D,sBAAsB;AACtB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,gBAAgB,2DAAoB;AACpC,oBAAoB;AACpB;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;;AAEA;AACA;AACA;;;;;;;;;;;;UCjIA;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;;;;WCrBA;WACA;WACA;WACA;WACA;WACA,gCAAgC,YAAY;WAC5C;WACA,E;;;;;WCPA;WACA;WACA;WACA;WACA,wCAAwC,yCAAyC;WACjF;WACA;WACA,E;;;;;WCPA,sF;;;;;WCAA;WACA;WACA;WACA,sDAAsD,kBAAkB;WACxE;WACA,+CAA+C,cAAc;WAC7D,E;;;;UCNA;UACA;UACA;UACA","file":"events.test.js","sourcesContent":["module.exports = require(\"path\");;","module.exports = require(\"vscode\");;","module.exports = require(\"chai\");;","module.exports = require(\"sinon\");;","module.exports = require(\"kite-api\");;","\"use strict\";\n\nconst path = require(\"path\");\nconst KiteAPI = require(\"kite-api\");\nconst { promisifyReadResponse } = require(\"../src/utils\");\n\nconst Kite = {\n  request(req, data) {\n    return KiteAPI.request(req, data).then(resp => promisifyReadResponse(resp));\n  }\n};\n\nfunction waitsFor(m, f, t, i) {\n  if (typeof m == \"function\" && typeof f != \"function\") {\n    i = t;\n    t = f;\n    f = m;\n    m = \"something to happen\";\n  }\n\n  const intervalTime = i || 10;\n  const timeoutDuration = t || 2000;\n\n  return new Promise((resolve, reject) => {\n    const interval = setInterval(() => {\n      const res = f();\n      if (res) {\n        if (res.then) {\n          res.then(\n            () => {\n              clearTimeout(timeout);\n              clearInterval(interval);\n              resolve();\n            },\n            err => {}\n          );\n        } else {\n          clearTimeout(timeout);\n          clearInterval(interval);\n          resolve();\n        }\n      }\n    }, intervalTime);\n\n    const timeout = setTimeout(() => {\n      clearInterval(interval);\n      let msg;\n      if (typeof m == \"function\") {\n        msg = `Waited ${timeoutDuration}ms for ${m()}`;\n      } else {\n        msg = `Waited ${timeoutDuration}ms for ${m} but nothing happened`;\n      }\n      reject(new Error(msg));\n    }, timeoutDuration);\n  });\n}\n\nfunction sleep(duration) {\n  const t = new Date();\n  return waitsFor(`${duration}ms`, () => {\n    return new Date() - t > duration;\n  });\n}\n\nfunction delay(duration, block) {\n  return new Promise(resolve => {\n    setTimeout(() => {\n      block();\n      resolve();\n    }, duration);\n  });\n}\n\nfunction fixtureURI(filepath) {\n  return path.resolve(__dirname, \"fixtures\", filepath);\n}\n\nfunction log(v) {\n  console.log(v);\n  return v;\n}\n\nfunction formatCall({ method, path, payload }) {\n  return `${method} ${path} ${payload || \"\"}`;\n}\n\nmodule.exports = {\n  sleep,\n  delay,\n  fixtureURI,\n  waitsFor,\n  Kite,\n  log,\n  formatCall\n};\n","'use strict';\n\nimport vscode from 'vscode';\nimport cp from 'child_process';\nimport os from 'os';\n\nimport KiteAPI from \"kite-api\";\n\nfunction promisifiedKiteAPIRequest(req, data) {\n  return KiteAPI.request(req, data).then(resp => promisifyReadResponse(resp));\n};\n\nconst compact = a => a.filter(v => v && v !== '');\n\nconst uniq = a => a.reduce((m, v) => m.indexOf(v) === -1 ? m.concat(v) : m, []);\n\nconst flatten = a =>\n  a.reduce((m, o) => m.concat(Array.isArray(o) ? flatten(o) : o), []);\n\nconst head = a => a[0];\nconst last = a => a[a.length - 1];\nconst log = v => (console.log(v), v);\n\nconst evalPath = (o, ...path) =>\n  path.reduce((m, k) => {\n    if (k === '*' && m) { k = head(Object.keys(m)); }\n    return m && typeof m[k] !== 'undefined' ? m[k] : undefined;\n  }, o);\n\nconst detailLang = o =>\n  o && o.language_details\n    ? head(Object.keys(o.language_details)).toLowerCase()\n    : 'python';\n\nconst detailGet = (o, ...k) => evalPath(o, 'language_details', '*', ...k);\n\nconst detailExist = (o, ...k) => detailGet(o, ...k) != null;\n\nconst detailNotEmpty = (o, ...k) => {\n  const v = detailGet(o, ...k);\n  return v != null && v.length > 0;\n};\n\nconst getDetails = (o, ...details) =>\n  o.detail || (o.details && details.reduce((m, k) => {\n    return m || o.details[k];\n  }, null));\n\nconst getFunctionDetails = (o) => {\n  const type = head(Object.keys(o.details).filter(k => o.details[k]));\n  if (type === 'function') {\n    return o.details.function;\n  } else if (type === 'type') {\n    return detailGet(o.details.type, 'constructor');\n  }\n\n  return null;\n};\n\nconst merge = (a, b) => {\n  const c = {};\n  for (const k in a) { c[k] = a[k]; }\n  for (const k in b) { c[k] = b[k]; }\n  return c;\n};\n\nconst stripTags = s => s.replace(/<[^>]+>/g, '');\n\nconst truncate = (s, l = 200) =>\n  s && s.length > l\n    ? s.slice(0, l) + 'â€¦'\n    : s;\n\nfunction parseJSON(data, fallback) {\n  try {\n    return JSON.parse(data);\n  } catch (e) {\n    return fallback;\n  }\n}\n\n// get time in seconds since the date\nfunction secondsSince(when) {\n  var now = new Date();\n  return (now.getTime() - when.getTime()) / 1000.0;\n}\n\nfunction promisifyRequest(request) {\n  return request.then\n    ? request\n    : new Promise((resolve, reject) => {\n      request.on('response', resp => resolve(resp));\n      request.on('error', err => reject(err));\n    });\n}\n\nfunction promisifyReadResponse(response) {\n  return new Promise((resolve, reject) => {\n    let data = '';\n    response.on('data', chunk => data += chunk);\n    response.on('end', () => resolve(data));\n    response.on('error', err => reject(err));\n  });\n}\n\nfunction delayPromise(factory, timeout) {\n  return new Promise((resolve, reject) => {\n    setTimeout(() => {\n      factory().then(resolve, reject);\n    }, timeout);\n  });\n}\n\nconst stopPropagationAndDefault = f => function(e) {\n  e.stopPropagation();\n  e.preventDefault();\n  return f && f.call(this, e);\n};\n\nconst editorsForDocument = document =>\n  vscode.window.visibleTextEditors.filter(e => e.document === document);\n\nfunction params (url) {\n  return url.query.split('&').reduce((m, p) => {\n    const [k,v] = p.split('=');\n    m[k] = v;\n    return m;\n  }, {});\n}\n\nconst escapeCommandArguments = (o) => {\n  if(vscode.version < \"1.30.0\") {\n    return JSON.stringify(o).replace(/\"/g, '&quot;');\n  }\n  if (os.platform() == 'win32') {\n    return JSON.stringify(o).replace(/\\\\\\\\/g, \"/\");\n  }\n  return JSON.stringify(o);\n};\n\nconst kiteOpen = (url) => {\n  const env = Object.assign({}, process.env);\n  delete env[\"ELECTRON_RUN_AS_NODE\"];\n  switch(os.platform()) {\n    case 'darwin':\n      cp.spawnSync(\"open\", [url], { env: env });\n      break;\n    case 'win32':\n      cp.spawnSync(\"cmd\", [\"/b\", \"/c\", \"start\",\"\", url], { env: env });\n      break;\n    case 'linux':\n      cp.spawnSync(\"xdg-open\", [url], { env: env });\n  }\n};\n\nconst extToLangMap = new Map([\n  [\"c\", \"c\"],\n  [\"cc\",\"cpp\"],\n  [\"cpp\",\"cpp\"],\n  [\"cs\",\"csharp\"],\n  [\"css\",\"css\"],\n  [\"go\",\"go\"],\n  [\"h\",\"c\"],\n  [\"hpp\",\"cpp\"],\n  [\"html\",\"html\"],\n  [\"java\", \"java\"],\n  [\"js\", \"javascript\"],\n  [\"jsx\",\"jsx\"],\n  [\"kt\",\"kotlin\"],\n  [\"less\",\"less\"],\n  [\"m\",\"objectivec\"],\n  [\"php\", \"php\"],\n  [\"py\", \"python\"],\n  [\"pyw\", \"python\"],\n  [\"rb\",\"ruby\"],\n  [\"scala\",\"scala\"],\n  [\"sh\",\"bash\"],\n  [\"ts\",\"typescript\"],\n  [\"tsx\",\"tsx\"],\n  [\"vue\",\"vue\"],\n]);\n\nconst getSupportedLanguage = document => {\n  if (document.isUntitled) {\n    return null;\n  }\n\n  const ext = document.fileName.split(\".\").slice(-1)[0];\n  if (extToLangMap.has(ext)) {\n    return extToLangMap.get(ext);\n  }\n  return null;\n};\n\nexport {\n  compact,\n  delayPromise,\n  flatten,\n  head,\n  last,\n  log,\n  escapeCommandArguments,\n  detailExist,\n  detailGet,\n  detailLang,\n  detailNotEmpty,\n  parseJSON,\n  promisifyReadResponse,\n  promisifyRequest,\n  secondsSince,\n  promisifiedKiteAPIRequest,\n  stopPropagationAndDefault,\n  truncate,\n  uniq,\n  stripTags,\n  editorsForDocument,\n  params,\n  merge,\n  getDetails,\n  getFunctionDetails,\n  kiteOpen,\n  getSupportedLanguage,\n};\n","module.exports = require(\"child_process\");;","module.exports = require(\"os\");;","'use strict';\nimport vscode from 'vscode';\nimport md5 from 'md5';\n\nimport { head } from './utils';\n\nfunction metricsCounterPath() {\n  return '/clientapi/metrics/counters';\n}\n\nfunction metricsCompletionSelectedPath() {\n  return '/clientapi/metrics/completions/selected';\n}\n\nfunction languagesPath() {\n  return '/clientapi/languages';\n}\n\nfunction accountPath() {\n  return '/api/account/user';\n}\n\nfunction statusPath(path) {\n  return [\n    '/clientapi/status',\n    `filename=${encodeURI(normalizeDriveLetter(path))}`,\n  ].join('?');\n}\n\nfunction signaturePath() {\n  return '/clientapi/editor/signatures';\n}\n\nfunction searchPath(query, offset = 0, limit = 10) {\n  return [\n    '/api/editor/search',\n    [\n      `q=${encodeURI(query)}`,\n      `offset=${offset}`,\n      `limit=${limit}`,\n    ].join('&'),\n  ].join('?');\n}\n\nfunction projectDirPath(path) {\n  return [\n    '/clientapi/projectdir',\n    `filename=${encodeURI(normalizeDriveLetter(path))}`,\n  ].join('?');\n}\n\nfunction shouldNotifyPath(path) {\n  return [\n    '/clientapi/permissions/notify',\n    `filename=${encodeURI(normalizeDriveLetter(path))}`,\n  ].join('?');\n}\n\nfunction settingsPath(key) {\n  return '/clientapi/settings/' + key;\n}\n\nfunction completionsPath() {\n  return '/clientapi/editor/complete';\n}\n\nfunction reportPath(data) {\n  const symbol = head(data.symbol);\n\n  return valueReportPath(symbol.id);\n}\n\nfunction valueReportPath(id) {\n  return `/api/editor/value/${id}`;\n}\n\nfunction symbolReportPath(id) {\n  return `/api/editor/symbol/${id}`;\n}\n\nfunction membersPath(id, page = 0, limit = 999) {\n  return [\n    `/api/editor/value/${id}/members`,\n    [\n      `offset=${page}`,\n      `limit=${limit}`,\n    ].join('&'),\n  ].join('?');\n}\n\nfunction usagesPath(id, page = 0, limit = 999) {\n  return [\n    `/api/editor/value/${id}/usages`,\n    [\n      `offset=${page}`,\n      `limit=${limit}`,\n    ].join('&'),\n  ].join('?');\n}\n\nfunction usagePath(id) {\n  return `/api/editor/usages/${id}`;\n}\n\nfunction examplePath(id) {\n  return `/api/python/curation/${id}`;\n}\n\nfunction openDocumentationInWebURL(id) {\n  const url = `http://localhost:46624/clientapi/desktoplogin?d=/docs/${escapeId(id)}`;\n  return url;\n}\n\nfunction openSignatureInWebURL(id) {\n  const url = `http://localhost:46624/clientapi/desktoplogin?d=/docs/${escapeId(id)}%23signature`;\n  return url;\n}\n\nfunction openExampleInWebURL(id) {\n  const url = `http://localhost:46624/clientapi/desktoplogin?d=/examples/python/${escapeId(id)}`;\n  return url;\n}\n\nfunction hoverPath(document, position) {\n  position = new vscode.Position(position.line, position.character);\n  const state = md5(document.getText());\n  const filename = document.fileName;\n  const buffer = cleanPath(filename);\n  const pos = document.offsetAt(position);\n  const encoding = 'utf-16';\n  return [\n    `/api/buffer/vscode/${buffer}/${state}/hover`,\n    [\n      `cursor_runes=${pos}`,\n      `offset_encoding=${encoding}`,\n    ].join('&'),\n  ].join('?');\n}\n\nfunction escapeId(id) {\n  return encodeURI(String(id)).replace(/;/g, '%3B');\n}\n\nfunction cleanPath(p) {\n  return encodeURI(normalizeDriveLetter(p))\n    .replace(/^([a-zA-Z]):/, (m, d) => `/windows/${d}`)\n    .replace(/\\/|\\\\|%5C/g, ':');\n}\n\nfunction serializeRangeForPath(range) {\n  return `${range.start.row}:${range.start.column}/${range.end.row}:${range.end.column}`;\n}\n\nfunction normalizeDriveLetter(str) {\n  return str.replace(/^[a-z]:/, m => m.toUpperCase());\n}\n\nexport {\n  accountPath,\n  completionsPath,\n  examplePath,\n  hoverPath,\n  languagesPath,\n  membersPath,\n  metricsCounterPath,\n  metricsCompletionSelectedPath,\n  normalizeDriveLetter,\n  openDocumentationInWebURL,\n  openExampleInWebURL,\n  openSignatureInWebURL,\n  projectDirPath,\n  reportPath,\n  searchPath,\n  serializeRangeForPath,\n  shouldNotifyPath,\n  settingsPath,\n  signaturePath,\n  statusPath,\n  symbolReportPath,\n  usagePath,\n  usagesPath,\n  valueReportPath,\n};\n","module.exports = require(\"md5\");;","'use strict';\n\nimport vscode from 'vscode';\n\nimport { expect } from 'chai';\nimport sinon from 'sinon';\n\nimport EditorEvents from '../src/events';\nimport { fixtureURI } from './helpers';\n\ndescribe('EditorEvents', () => {\n  let editor, events, Kite;\n\n  beforeEach(() => {\n    // We're going to fake most objects that are used by the editor events\n    // because of how VSCode testing environment works.\n    // For instance we can't get a reference to the editor of a created document.\n    Kite = {\n      request: sinon.stub().returns(Promise.resolve()),\n      checkState: sinon.stub().returns(Promise.resolve()),\n    };\n\n    const uri = vscode.Uri.file(fixtureURI('sample.py'));\n\n    return vscode.workspace.openTextDocument(uri)\n    .then(doc => {\n      editor = {\n        document: doc,\n        selection: {\n          start: new vscode.Position(0,0),\n          end: new vscode.Position(0,0),\n        },\n      };\n\n      events = new EditorEvents(Kite, editor);\n    });\n  });\n\n  it('only sends one event to kited', () => {\n    return Promise.all([\n      events.selectionChanged(),\n      events.edit(),\n    ])\n    .then(() => {\n      expect(Kite.request.callCount).to.eql(1);\n\n      const [, json] = Kite.request.getCall(0).args;\n      const payload = JSON.parse(json);\n      expect(payload.action).to.eql('edit');\n    });\n  });\n});\n","'use strict';\n\nimport { version as editor_version } from 'vscode';\n\nimport kitePkg from '../package.json'\nconst plugin_version = kitePkg.version\n\nimport { normalizeDriveLetter } from './urls';\n\nexport default class EditorEvents {\n  constructor(Kite, editor) {\n    this.Kite = Kite;\n    this.editor = editor;\n    this.reset();\n  }\n\n  dispose() {\n    delete this.Kite;\n    delete this.editor;\n  }\n\n  focus() {\n    return this.send('focus');\n  }\n\n  edit() {\n    return this.send('edit');\n  }\n\n  selectionChanged() {\n    return this.send('selection');\n  }\n\n  send(action) {\n    if (!this.pendingPromise) {\n      this.pendingPromise = new Promise((resolve, reject) => {\n        this.pendingPromiseResolve = resolve;\n        this.pendingPromiseReject = reject;\n      });\n    }\n    this.pendingEvents.push(action);\n    clearTimeout(this.timeout);\n    this.timeout = setTimeout(() => this.mergeEvents(), 0);\n    // was resulting in unhandled Promise rejection from `this.pendingPromiseReject(err)`\n    // below... so we catch it\n    return this.pendingPromise.catch(() => { });\n  }\n\n  reset() {\n    clearTimeout(this.timeout);\n    this.pendingEvents = [];\n  }\n\n  mergeEvents() {\n    if (!this.editor || !this.editor.document) {\n      return;\n    }\n\n    const editor = this.editor;\n    const doc = editor.document;\n    const focus = this.pendingEvents.filter(e => e === 'focus')[0];\n    const action = this.pendingEvents.some(e => e === 'edit') ? 'edit' : this.pendingEvents.pop();\n\n    this.reset();\n\n    const payload = JSON.stringify(this.buildEvent(action, doc, editor.selection));\n\n    let promise = Promise.resolve();\n\n    if (focus && action !== focus) {\n      promise = promise.then(() => this.Kite.request({\n        path: '/clientapi/editor/event',\n        method: 'POST',\n      }, JSON.stringify(this.buildEvent(focus, doc, editor.selection)), doc));\n    }\n\n    return promise\n      .then(() => this.Kite.request({\n        path: '/clientapi/editor/event',\n        method: 'POST',\n      }, payload, doc))\n      .then((res) => {\n        this.pendingPromiseResolve && this.pendingPromiseResolve(res);\n      })\n      .catch((err) => {\n        this.pendingPromiseReject && this.pendingPromiseReject(err);\n      })\n      .then(() => {\n        delete this.pendingPromise;\n        delete this.pendingPromiseResolve;\n        delete this.pendingPromiseReject;\n      });\n  }\n\n  buildEvent(action, document, selection) {\n    const content = document.getText();\n    return content.length > this.Kite.maxFileSize\n      ? {\n        source: 'vscode',\n        action: 'skip',\n        text: '',\n        filename: normalizeDriveLetter(document.fileName),\n        selections: [{ start: 0, end: 0, encoding: 'utf-16' }],\n        editor_version,\n        plugin_version\n      }\n      : this.makeEvent(action, document, content, selection);\n  }\n\n  makeEvent(action, document, text, selection) {\n    const event = {\n      source: 'vscode',\n      text,\n      action,\n      filename: normalizeDriveLetter(document.fileName),\n      editor_version,\n      plugin_version\n    };\n\n    if (selection && selection.start != null && selection.end != null) {\n      event.selections = [{\n        start: document.offsetAt(selection.start),\n        end: document.offsetAt(selection.end),\n        encoding: 'utf-16',\n      }];\n    }\n\n    return event;\n  }\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => module['default'] :\n\t\t() => module;\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => Object.prototype.hasOwnProperty.call(obj, prop)","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","// module exports must be returned from runtime so entry inlining is disabled\n// startup\n// Load entry module and return exports\nreturn __webpack_require__(29);\n"],"sourceRoot":""}